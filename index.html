<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Generator Bot (Webç‰ˆ)</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* å†…ç½®ä¸€ä¸ª loading åŠ¨ç”» */
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      animation: spin 1s linear infinite;
      margin: 6px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #history {
      margin-top: 20px;
      padding: 10px;
      border-top: 1px solid #ccc;
    }

    .entry {
      margin-bottom: 20px;
      padding: 10px;
      border-radius: 8px;
      background: #f9f9f9;
    }

    .entry img {
      max-width: 300px;
      border-radius: 6px;
      margin-top: 10px;
      display: block;
    }

    .command {
      font-weight: bold;
      color: #2c3e50;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>ğŸ¨ Image Generator Bot</h1>
    <p>è¾“å…¥æŒ‡ä»¤ï¼ˆæ”¯æŒ: <code>!ping</code>, <code>!imagine prompt</code>ï¼‰</p>
    <input id="command" type="text" placeholder="è¾“å…¥å‘½ä»¤...">
    <button id="run">è¿è¡Œ</button>
    <div id="history"></div>
  </div>

  <script>
    const runBtn = document.getElementById('run');
    const cmdInput = document.getElementById('command');
    const historyDiv = document.getElementById('history');

    function addEntry(content, isLoading = false) {
      const entry = document.createElement('div');
      entry.className = 'entry';

      if (isLoading) {
        entry.innerHTML = `
          <div class="spinner"></div>
          <p>â³ æ­£åœ¨å¤„ç†: <span class="command">${content}</span></p>
        `;
      } else {
        entry.innerHTML = content;
      }

      historyDiv.prepend(entry); // æ–°ç»“æœæ”¾åœ¨æœ€ä¸Šé¢
      return entry;
    }

    async function runCommand() {
      const cmd = cmdInput.value.trim();
      if (!cmd) {
        addEntry("âŒ è¯·è¾“å…¥å‘½ä»¤");
        return;
      }

      const loadingEntry = addEntry(cmd, true);

      try {
        if (cmd.startsWith('!ping')) {
          const res = await fetch('/api/ping');
          const data = await res.json();
          loadingEntry.innerHTML = `<p>âœ… ${cmd} â†’ ${data.message}</p>`;
        } else if (cmd.startsWith('!imagine')) {
          const prompt = cmd.replace('!imagine', '').trim();
          const res = await fetch('/api/imagine?prompt=' + encodeURIComponent(prompt));
          const data = await res.json();

          if (data.image) {
            loadingEntry.innerHTML = `
              <p>ğŸ–¼ï¸ <span class="command">${cmd}</span></p>
              <img src="${data.image}" alt="ç”Ÿæˆçš„å›¾åƒ">
            `;
          } else {
            loadingEntry.innerHTML = `<p>âš ï¸ å›¾åƒç”Ÿæˆå¤±è´¥: ${data.error || "æœªçŸ¥é”™è¯¯"}</p>`;
          }
        } else {
          loadingEntry.innerHTML = `<p>âŒ æœªçŸ¥å‘½ä»¤: <span class="command">${cmd}</span></p>`;
        }
      } catch (err) {
        console.error("å‰ç«¯é”™è¯¯:", err);
        loadingEntry.innerHTML = `<p>âš ï¸ è¯·æ±‚å¤±è´¥: ${err.message}</p>`;
      }
    }

    // ç‚¹å‡»æŒ‰é’®æ‰§è¡Œ
    runBtn.addEventListener('click', runCommand);

    // æŒ‰å›è½¦æ‰§è¡Œ
    cmdInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        runCommand();
      }
    });
  </script>
</body>
</html>
